# DevSecOps Kubernetes Security â€“ Detailed Notes (Developer â†’ DevOps Level)

> **Purpose:**
> Yeh document un sab concepts ko ek jagah detail mein samjhaata hai jo humne abhi tak practically seekhe hain â€” *CIS kube-bench, Trivy Kubernetes scan, aur kubesec YAML security scanning*.
>
> Style intentionally **developer-friendly + DevOps mindset** mein rakha gaya hai, taaki cheezon ka **whyâ€“whatâ€“how** clear ho.

---

## 1ï¸âƒ£ Kubernetes Security ka Big Picture

Kubernetes security ko sirf ek tool se nahi samjha ja sakta. Yeh **layers** mein hoti hai:

```
Developer YAML
   â†“
Static YAML Security (kubesec)
   â†“
Cluster Configuration Security (kube-bench / CIS)
   â†“
Runtime & Image Security (Trivy)
```

Har tool ka **alag role** hota hai:

| Tool       | Level           | Kya check karta hai           |
| ---------- | --------------- | ----------------------------- |
| kubesec    | Developer       | Deployment YAML design safety |
| kube-bench | Infra / Cluster | CIS Benchmark compliance      |
| Trivy      | DevSecOps       | Vulns + misconfig + runtime   |

---

## 2ï¸âƒ£ kube-bench (CIS Kubernetes Benchmark)

### ğŸ“Œ kube-bench kya hai?

`kube-bench` ek tool hai jo Kubernetes cluster ko **CIS (Center for Internet Security) Benchmark** ke against check karta hai.

> CIS benchmark = industry standard hardening rules

Yeh cluster ke **control-plane, worker nodes, kubelet, RBAC** wagaira ko audit karta hai.

---

### ğŸ§ª kube-bench kaise run hota hai (real world)

Managed clusters (AKS / EKS / GKE) mein:

* kube-bench **binary nahi**
* balki **Pod / Job** ke form mein run hota hai

Isliye hum:

```bash
kubectl get pods
kubectl logs kube-bench-xxxxx > cis-raw.txt
```

---

### ğŸ“Š kube-bench Output samajhna

Output types:

* `[PASS]` â†’ setting secure hai
* `[FAIL]` â†’ **security risk** (fix zaroori)
* `[WARN]` â†’ improvement recommended

Example:

```
[FAIL] 4.1.1 Ensure kubelet service file permissions are 600
[FAIL] 4.1.9 kubelet config.yaml permissions not 600
```

---

### ğŸ”´ Example: FAIL 4.1.1 â€“ kubelet service permissions

**Problem:**

* kubelet service file readable by non-root users

**Risk:**

* kubelet arguments leak
* attacker node behavior samajh sakta hai

**Fix:**

```bash
chmod 600 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
```

---

### ğŸ”´ Example: FAIL 4.1.9 â€“ kubelet config.yaml permissions

**File:**

```
/var/lib/kubelet/config.yaml
```

**Fix:**

```bash
chmod 600 /var/lib/kubelet/config.yaml
```

---

### ğŸ§  kube-bench se kya seekhna chahiye

* Cluster hardening YAML se nahi hoti
* Node-level security equally important hai
* CIS compliance = audit + enterprise requirement

---

## 3ï¸âƒ£ Trivy â€“ Kubernetes Security Scanner

### ğŸ“Œ Trivy kya hai?

Trivy ek **multi-purpose security scanner** hai jo:

* Container images
* Kubernetes configs
* Cluster RBAC
* Misconfigurations

sab scan karta hai.

---

### ğŸ§ª Trivy Kubernetes cluster scan

Important concept:

> Trivy **cluster name nahi leta**
> Wo `kubectl current-context` follow karta hai

Correct command:

```bash
trivy k8s --report summary
```

---

### ğŸ§¾ Trivy HTML Report (Audit-ready)

Steps:

1. JSON output

```bash
trivy k8s --report summary --format json --output trivy.json
```

2. HTML convert

```bash
trivy convert \
  --format template \
  --template "@trivy-html.tpl" \
  --output trivy-report.html \
  trivy.json
```

Use-case:

* Manager
* Security audit
* Resume proof

---

## 4ï¸âƒ£ kubesec â€“ Deployment YAML Security Scanner

### ğŸ“Œ kubesec kya hai?

`kubesec` ek **static YAML security analyzer** hai.

> Ye cluster ko touch bhi nahi karta
> Sirf YAML design check karta hai

Matlab:

> "Is YAML se deploy karna safe hai ya nahi?"

---

### ğŸ§ª kubesec kaise use karte hain

```bash
kubesec scan deployment.yaml
```

---

### ğŸ“Š kubesec Output ka structure

Example:

```json
score: -30
critical: Privileged
```

---

### ğŸ”´ Critical: Privileged container

YAML:

```yaml
securityContext:
  privileged: true
```

**Meaning:**

* Container ko host-level powers mil rahi hain
* Node compromise possible

**Result:**

* kubesec ne -30 score diya

---

### ğŸŸ  Advise section (best practices)

Ye errors nahi hote, balki **security suggestions**:

* runAsNonRoot
* resource limits
* drop capabilities
* readOnlyRootFilesystem
* disable automountServiceAccountToken

---

### âœ… Secure Deployment Example

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: secure-app
spec:
  replicas: 1
  template:
    spec:
      automountServiceAccountToken: false
      securityContext:
        runAsNonRoot: true
        runAsUser: 10001
        runAsGroup: 10001
      containers:
      - name: app
        image: nginx
        securityContext:
          privileged: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: ["ALL"]
        resources:
          requests:
            cpu: "100m"
            memory: "128Mi"
          limits:
            cpu: "200m"
            memory: "256Mi"
```

Expected kubesec result:

```
score: +5
No critical issues
```

---

## 5ï¸âƒ£ DevSecOps Mindset â€“ Final Takeaways

* âŒ Security baad mein nahi aati
* âœ… Security **YAML likhte waqt** start hoti hai

Golden rule:

```
Prevent > Detect > React
```

| Stage         | Tool       |
| ------------- | ---------- |
| Before deploy | kubesec    |
| Before prod   | Trivy      |
| Infra audit   | kube-bench |

---

## ğŸ¤ Interview-ready Summary

> â€œI follow a layered Kubernetes security approach: kubesec for YAML design security, Trivy for cluster and configuration scanning, and kube-bench for CIS benchmark compliance.â€

---

## ğŸš€ Next Possible Extensions

* Jenkins pre-commit YAML guard
* Pod Security Standards (restricted)
* RBAC hardening examples
* AKS / EKS production checklist

---

**End of Notes**
